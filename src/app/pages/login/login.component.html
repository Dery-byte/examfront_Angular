<app-navbar></app-navbar>

<div class="page-container">
  <div class="accent-bar"></div>
  <div class="bg-glow"></div>
  <div class="grid-lines"></div>

  <main class="main-content">
    <div class="login-wrap">

      <!-- Logo -->
      <div class="logo-area">
        <div class="logo-tile">
          <span>OTC</span>
        </div>
      </div>

      <!-- Heading -->
      <div class="page-title-area">
        <h1 class="page-title">Welcome back</h1>
        <p class="page-subtitle">
          <span
            [appTyping]="['Sign in to your OTC account', 'Access your trading dashboard', 'Your session is secure']"
            [speed]="65"
            [eraseSpeed]="38"
            [delayBetween]="2300">
          </span>
          <span class="typing-cursor">|</span>
        </p>
      </div>

      <!-- Card -->
      <div class="login-card">

        <!-- SSO -->
        <div class="sso-row">
          <button type="button" class="sso-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/>
              <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            Google
          </button>
          <button type="button" class="sso-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.44 9.8 8.21 11.39.6.11.79-.26.79-.58v-2.23c-3.34.72-4.03-1.42-4.03-1.42-.55-1.39-1.34-1.76-1.34-1.76-1.09-.74.08-.73.08-.73 1.2.08 1.84 1.24 1.84 1.24 1.07 1.83 2.81 1.3 3.49 1 .11-.78.42-1.3.76-1.6-2.66-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1.01-.32 3.3 1.23.96-.27 1.98-.4 3-.4s2.04.13 3 .4c2.28-1.55 3.29-1.23 3.29-1.23.65 1.66.24 2.88.12 3.18.77.84 1.23 1.91 1.23 3.22 0 4.61-2.81 5.63-5.48 5.92.43.37.81 1.1.81 2.22v3.29c0 .32.19.69.8.57C20.57 21.8 24 17.3 24 12c0-6.63-5.37-12-12-12z"/>
            </svg>
            GitHub
          </button>
        </div>

        <!-- Divider -->
        <div class="or-divider">
          <div class="or-line"></div>
          <span class="or-text">or with credentials</span>
          <div class="or-line"></div>
        </div>

        <!-- Form -->
        <form (ngSubmit)="formSubmit()">
          <div class="form-fields">

            <div class="field-block">
              <label class="field-lbl">Username</label>
              <div class="field-shell">
                <span class="fi">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="7" r="4"/><path d="M5.5 21a8.38 8.38 0 0 1 13 0"/>
                  </svg>
                </span>
                <input [(ngModel)]="loginData.username" name="username" required type="text"
                  placeholder="your.username" autocomplete="username">
              </div>
            </div>

            <div class="field-block">
              <label class="field-lbl">Password</label>
              <div class="field-shell">
                <span class="fi">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                  </svg>
                </span>
                <input [(ngModel)]="loginData.password" required name="password"
                  [type]="hidePassword ? 'password' : 'text'"
                  placeholder="••••••••••" autocomplete="current-password">
                <button type="button" class="eye-toggle" (click)="hidePassword = !hidePassword">
                  <svg *ngIf="hidePassword" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
                  </svg>
                  <svg *ngIf="!hidePassword" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/>
                    <line x1="1" y1="1" x2="23" y2="23"/>
                  </svg>
                </button>
              </div>
            </div>

          </div><!-- /form-fields -->

          <!-- Forgot -->
          <div class="util-row">
            <button type="button" class="forgot-link" (click)="openUpdateDialog(updateDialog)">
              Forgot password?
            </button>
          </div>

          <!-- Submit -->
          <button type="submit" class="go-btn" [disabled]="loading">
            <span class="shimmer"></span>
            <mat-spinner *ngIf="loading" diameter="16" strokeWidth="2" class="btn-spinner"></mat-spinner>
            <span class="btn-txt">{{ loading ? 'Signing in…' : 'Continue' }}</span>
            <svg *ngIf="!loading" class="arr" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </button>

        </form>

        <!-- Signup prompt -->
        <div class="signup-row">
          <span class="signup-text">Don't have an account?</span>
          <a routerLink="/signup" class="signup-btn">
            Create account
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </a>
        </div>

        <!-- Security -->
        <div class="sec-row">
          <div class="sec-dot"></div>
          <span class="sec-label">TLS 1.3 · AES-256 · FIDO2</span>
        </div>

      </div><!-- /login-card -->

      <!-- Page footer -->
      <div class="foot-links">
        <a routerLink="/privacy">Privacy</a>
        <div class="foot-sep"></div>
        <a routerLink="/terms">Terms</a>
        <div class="foot-sep"></div>
        <a href="#">Support</a>
      </div>

    </div><!-- /login-wrap -->
  </main>

  <div class="copy-bar">
    <span>© 2025 OTC PLATFORM — ALL RIGHTS RESERVED</span>
  </div>
</div><!-- /page-container -->


<!-- ═══════════════════════════════════════
     RESET PASSWORD MODAL
     ═══════════════════════════════════════ -->
<ng-template #updateDialog let-data="data">
  <div class="modal-box">

    <button class="modal-close" (click)="onCloseDialog()" *ngIf="!showSuccessMessage">
      <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M18 6L6 18M6 6l12 12"/>
      </svg>
    </button>

    <div mat-dialog-content class="modal-dialog-content">

      <!-- Success view -->
      <div *ngIf="showSuccessMessage" class="modal-success">
        <div class="modal-success-icon">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
        </div>
        <h3>Code sent</h3>
        <p>A reset code was sent to <strong>{{ successPhone }}</strong></p>
        <button class="modal-done-btn" (click)="onCloseDialog()">Done</button>
      </div>

      <!-- Form view -->
      <div *ngIf="!showSuccessMessage">
        <div class="modal-tag">
          <span class="modal-tag-dot"></span>
          Recovery
        </div>
        <h2 class="modal-title">Reset password</h2>
        <p class="modal-sub">Enter your phone number and we'll send a one-time reset code.</p>

        <form #resetForm="ngForm" (ngSubmit)="onForgotPasswordSubmit(resetForm)">

          <div class="modal-field-wrap">
            <span class="mfi">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.69 12 19.79 19.79 0 0 1 1.61 3.4 2 2 0 0 1 3.58 1.22h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L7.91 8.77a16 16 0 0 0 6.29 6.29l1.64-1.64a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/>
              </svg>
            </span>
            <input [(ngModel)]="resetDataPhone.phone" name="phone" type="tel"
              placeholder="0544 073 427" #phone="ngModel" required
              pattern="^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$"
              autocomplete="tel">
          </div>

          <div *ngIf="phone.invalid && (phone.dirty || phone.touched)" class="modal-field-error">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
            <span *ngIf="phone.errors?.['required']">Phone number is required</span>
            <span *ngIf="phone.errors?.['pattern']">Enter a valid phone number</span>
          </div>

          <div *ngIf="apiError" class="modal-error">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
            {{ apiError }}
          </div>

          <div class="modal-actions">
            <button type="button" class="modal-cancel-btn" (click)="onCloseDialog()">Cancel</button>
            <button type="submit" class="modal-send-btn" [disabled]="isSubmitting || resetForm.invalid">
              <mat-spinner *ngIf="isSubmitting" diameter="14" class="btn-spinner"></mat-spinner>
              <svg *ngIf="!isSubmitting" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
              </svg>
              <span>{{ isSubmitting ? 'Sending…' : 'Send Code' }}</span>
            </button>
          </div>

        </form>
      </div>

    </div>
  </div>
</ng-template>